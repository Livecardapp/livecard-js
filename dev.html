<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- LiveCard dependencies -->
  <script src="/livecard.js"></script>
  <!-- LiveCard dependencies -->

  <title>Checkout</title>

  <script type="text/javascript">
    LiveCard.Settings.licenseKey = "zeGBS3PiwkhBSpn-JDbz";
    let cardId = null;
    let lastView = 0;

    function createVideoMessage() {
      let lastView = 1;
      LiveCard.startVideoRecording({
        showIntro: true, //Client can opt out of showing our intro by passing false here
        onSuccess: function () {
          collectPhoneNumber();
        },
        onFailure: function (errorCode) {
          console.log('video message failure', errorCode);
          if (errorCode === LiveCard.ErrorType.RECORDING_NOT_SUPPORTED) {
            // Client can show own UI for case of webcam recording not supported and expose some UI 
            // to choose a file from hd, which triggers LiveCard.selectVideoFile()
            // Or can use our own modal as here
            setTimeout(function () { LiveCard.showRecordingNotSupported(); }, 400);
          } else if (errorCode === LiveCard.ErrorType.VIDEO_SIZE_TOO_LARGE) {
            console.log('VIDEO size too large');
          }
        }
      });
    }

    function createGiftMessage() {
      lastView = 2;
      LiveCard.showGiftTextInput({
        showIntro: true, //Client can opt out of showing our intro by passing false here
        onFailure: (errorCode) => {
          if (errorCode === LiveCard.ErrorType.RECORDING_NOT_SUPPORTED) {
            // Client can show own UI for case of webcam recording not supported and expose some UI 
            // to choose a file from hd, which triggers LiveCard.selectVideoFile()
            // Or can use our own modal as here
            setTimeout(function () { LiveCard.showRecordingNotSupported(); }, 400);
          } else if (errorCode === LiveCard.ErrorType.IMAGE_SIZE_TOO_LARGE) {
            console.log('IMAGE size too large');
          }
        },
        onSuccess: () => {
          collectPhoneNumber();
        },
      });
    }

    function createImageMessage() {
      lastView = 3;
      LiveCard.showImageInput({
        onFailure: () => {
          console.log('failed image');
        },
        onSuccess: () => {
          collectPhoneNumber();
        }
      });
    }

    function collectPhoneNumber() {
      //Client can collect phone with own UI and set directly like here or use our modal as below
      //LiveCard.recipientPhone = '1234567890';
      LiveCard.showPhoneInput({
        onBack: () => {
          switch (lastView) {
            case 1:
              createVideoMessage();
              break;
            case 2:
              createGiftMessage();
              break;
            case 3:
              createImageMessage();
              break;
            default:
              break;
          }
        },
        onSuccess: () => {
          //update UI if needed
        }
      });
    }

    function submitOrder() {
      LiveCard.createCard({
        onSuccess: function (liveCardId, mediaUrl) {
          document.getElementById('submit-order-label').innerHTML = 'Got media url: ' + mediaUrl + ' for LiveCard ID: ' + liveCardId;
          cardId = liveCardId;
        },
        onFailure: function (error) {
          document.getElementById('submit-order-label').innerHTML = 'createCard error: ' + error;
        }
      });
    }

    function confirmLastOrder() {
      LiveCard.confirmCard({
        onSuccess: function () {
          document.getElementById('confirm-last-order-label').innerHTML = 'Confirmed LiveCard order ' + cardId;
        },
        onFailure: function (error) {
          document.getElementById('confirm-last-order-label').innerHTML = 'Confirm error: ' + error;
        }
      });
    }

    function flashLog(msg) {
      console.log(msg);
    }

  </script>

</head>

<body>
  <button onclick="createVideoMessage()">Create Video Message</button><br><br>
  <button onclick="createGiftMessage()">Create Gift Message</button><br><br>
  <button onclick="createImageMessage()">Create Image Message</button><br><br>
  <button id="submit-order" onclick="submitOrder()">Submit Order</button><br><br>
  <label id="submit-order-label" for="submit-order"></label><br><br>
  <button id="confirm-last-order" onclick="confirmLastOrder()">Confirm Order</button><br><br>
  <label id="confirm-last-order-label" for="confirm-last-order"></label>
</body>

</html>