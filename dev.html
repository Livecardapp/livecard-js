<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- LiveCard dependencies -->
  <!-- <script src="/livecard-sdk/flash/swfobject.js"></script> -->
  <script src="/livecard.js"></script>
  <!-- LiveCard dependencies -->

  <title>Checkout</title>

  <script type="text/javascript">
    LiveCard.Settings.licenseKey = "zeGBS3PiwkhBSpn-JDbz";
    let cardId = null;
    let lastView = 0;

    function createTextMessage() {
      lastView = 1;
      LiveCard.showGiftTextInput({
        showIntro: true, //Client can opt out of showing our intro by passing false here
        onFailure: (errorCode) => {
          console.log('failed image', errorCode);
        },
        onSuccess: () => {
          collectPhoneNumber();
        },
      });
    }

    function createAudioMessage() {
      let lastView = 2;
      LiveCard.startAudioRecording({
        showIntro: true, //Client can opt out of showing our intro by passing false here
        onSuccess: function () {
          collectPhoneNumber();
        },
        onFailure: function (errorCode) {
          console.log('AUDIO message failure', errorCode);
          if (errorCode === LiveCard.ErrorType.RECORDING_NOT_SUPPORTED) {
            // Client can show own UI for case of webcam recording not supported and expose some UI 
            // to choose a file from hd, which triggers LiveCard.selectVideoFile()
            // Or can use our own modal as here
            setTimeout(function () { LiveCard.showRecordingNotSupported(); }, 400);
          } else if (errorCode === LiveCard.ErrorType.RECORDING_UNAUTHROIZED) {
            console.log('AUDIO access denied');
            setTimeout(function () { LiveCard.showRecordingNotSupported(); }, 400);
          } else if (errorCode === LiveCard.ErrorType.AUDIO_SIZE_TOO_LARGE) {
            console.log('AUDIO size too large');
          }
        }
      });
    }

    function createImageMessage() {
      lastView = 3;
      LiveCard.showImageInput({
        onFailure: (errorCode) => {
          console.log('IMAGE message failure', errorCode);
          if (errorCode === LiveCard.ErrorType.RECORDING_NOT_SUPPORTED) {
            // Client can show own UI for case of webcam recording not supported and expose some UI 
            // to choose a file from hd, which triggers LiveCard.selectVideoFile()
            // Or can use our own modal as here
            setTimeout(function () { LiveCard.showRecordingNotSupported(); }, 400);
          } else if (errorCode === LiveCard.ErrorType.RECORDING_UNAUTHROIZED) {
            console.log('IMAGE camera access denied');
            setTimeout(function () { LiveCard.showRecordingNotSupported(); }, 400);
          } else if (errorCode === LiveCard.ErrorType.IMAGE_SIZE_TOO_LARGE) {
            console.log('IMAGE size too large');
          }
        },
        onSuccess: () => {
          collectPhoneNumber();
        }
      });
    }

    function createVideoMessage() {
      let lastView = 4;
      LiveCard.startVideoRecording({
        showIntro: true, //Client can opt out of showing our intro by passing false here
        onSuccess: function () {
          collectPhoneNumber();
        },
        onFailure: function (errorCode) {
          console.log('video message failure', errorCode);
          if (errorCode === LiveCard.ErrorType.RECORDING_NOT_SUPPORTED) {
            // Client can show own UI for case of webcam recording not supported and expose some UI 
            // to choose a file from hd, which triggers LiveCard.selectVideoFile()
            // Or can use our own modal as here
            setTimeout(function () { LiveCard.showRecordingNotSupported(); }, 400);
          } else if (errorCode === LiveCard.ErrorType.RECORDING_UNAUTHROIZED) {
            console.log('VIDEO camera access denied');
            setTimeout(function () { LiveCard.showRecordingNotSupported(); }, 400);
          } else if (errorCode === LiveCard.ErrorType.VIDEO_SIZE_TOO_LARGE) {
            console.log('VIDEO size too large');
          }
        }
      });
    }

    function collectPhoneNumber() {
      //Client can collect phone with own UI and set directly like here or use our modal as below
      //LiveCard.recipientPhone = '1234567890';
      LiveCard.showPhoneInput({
        onBack: () => {
          switch (lastView) {
            case 1:
              createTextMessage();
              break;
            case 2:
              createAudioMessage();
              break;
            case 3:
              createImageMessage();
              break;
            case 4:
              createVideoMessage();
              break;
            default:
              break;
          }
        },
        onSuccess: () => {
          //update UI if needed
        }
      });
    }

    function submitOrder() {
      LiveCard.createCard({
        onSuccess: function (liveCardId, mediaUrl) {
          document.getElementById('submit-order-label').innerHTML = 'Got media url: ' + mediaUrl + ' for LiveCard ID: ' + liveCardId;
          cardId = liveCardId;
        },
        onFailure: function (error) {
          document.getElementById('submit-order-label').innerHTML = 'createCard error: ' + error;
        }
      });
    }

    function confirmLastOrder() {
      LiveCard.confirmCard({
        onSuccess: function () {
          document.getElementById('confirm-last-order-label').innerHTML = 'Confirmed LiveCard order ' + cardId;
        },
        onFailure: function (error) {
          document.getElementById('confirm-last-order-label').innerHTML = 'Confirm error: ' + error;
        }
      });
    }

    function flashLog(msg) {
      console.log(msg);
    }

  </script>

</head>

<body>
  <button onclick="createTextMessage()">Create Gift Message</button><br><br>
  <button onclick="createAudioMessage()">Create Audio Message</button><br><br>
  <button onclick="createImageMessage()">Create Image Message</button><br><br>
  <button onclick="createVideoMessage()">Create Video Message</button><br><br>
  <button id="submit-order" onclick="submitOrder()">Submit Order</button><br><br>
  <label id="submit-order-label" for="submit-order"></label><br><br>
  <button id="confirm-last-order" onclick="confirmLastOrder()">Confirm Order</button><br><br>
  <label id="confirm-last-order-label" for="confirm-last-order"></label>
</body>

</html>